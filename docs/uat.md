# UAT - User Acceptance Testing

## Сценарии тестирования по ролям

### 1. Гость (неавторизованный пользователь)

#### Сценарий 1.1: Просмотр публичных страниц
- [ ] Открыть `/` → должна загрузиться главная страница
- [ ] Открыть `/login` → должна загрузиться форма входа
- [ ] Открыть `/staff/login` → должна загрузиться форма входа для сотрудников

#### Сценарий 1.2: Редиректы для неавторизованных
- [ ] Открыть `/admin` → должен быть редирект на `/staff/login?next=/admin`
- [ ] Открыть `/office` → должен быть редирект на `/staff/login?next=/office`
- [ ] Открыть `/cabinet` → должен быть редирект на `/login?next=/cabinet`

### 2. Администратор (admin)

#### Сценарий 2.1: Вход в админку
- [ ] Открыть `/staff/login`
- [ ] Ввести код администратора
- [ ] После входа должен быть редирект на `/admin`
- [ ] Должен быть виден `admin-shell` и `admin-quick-actions`

#### Сценарий 2.2: Навигация по админке
- [ ] Открыть `/admin` → должен быть виден дашборд с quick actions
- [ ] Перейти на `/admin/plots` → должен быть виден реестр участков
- [ ] Перейти на `/admin/billing` → должен быть виден биллинг
- [ ] Перейти на `/admin/appeals` → должны быть видны обращения
- [ ] Перейти на `/admin/notifications/debtors` → должны быть видны должники

#### Сценарий 2.3: Доступ к офису
- [ ] Открыть `/office` → должен быть доступ (admin имеет доступ к офису)
- [ ] Должен быть виден `office-shell`

#### Сценарий 2.4: Ограничения доступа
- [ ] Открыть `/cabinet` → должен быть редирект на `/forbidden`
- [ ] На странице `/forbidden` должны быть CTA (Назад, В админку, На сайт, Выйти)

### 3. Председатель (chairman)

#### Сценарий 3.1: Вход в офис
- [ ] Открыть `/staff/login`
- [ ] Ввести логин/пароль председателя
- [ ] После входа должен быть редирект на `/office/dashboard`
- [ ] Должен быть виден `office-shell` и `office-quick-actions`

#### Сценарий 3.2: Навигация по офису
- [ ] Открыть `/office` → должен быть виден дашборд (`office-dashboard-page`) с метриками (новые обращения, в работе, просрочено)
- [ ] Открыть `/office/inbox` → должна быть видна очередь работы (`office-inbox-page`) с фильтрами (new, in_progress, needs_info, overdue, closed)
- [ ] Открыть `/office/search` → должна быть видна страница поиска (`office-search-page`) с поисковой строкой
- [ ] Открыть `/office/appeals` → должны быть видны обращения (`office-appeals-page`)
- [ ] Открыть `/office/appeals/[id]` → должна быть видна карточка обращения с действиями по роли
- [ ] Открыть `/office/registry` → должен быть виден реестр участков
- [ ] Открыть `/office/registry/[id]` → должна быть видна карточка участка (Plot 360) с контактами, обращениями, финансами, активностью
- [ ] Открыть `/office/finance` → должны быть видны финансы (`office-finance-page`) с обзором
- [ ] Открыть `/office/announcements` → должны быть видны объявления (`office-announcements-page`)

#### Сценарий 3.3: Ограничения доступа
- [ ] Открыть `/admin` → должен быть редирект на `/forbidden`
- [ ] Открыть `/cabinet` → должен быть редирект на `/forbidden`

### 4. Секретарь (secretary)

#### Сценарий 4.1: Вход в офис
- [ ] Открыть `/staff/login`
- [ ] Ввести логин/пароль секретаря
- [ ] После входа должен быть редирект на `/office/dashboard`
- [ ] Должен быть виден `office-shell`

#### Сценарий 4.2: Доступ к разделам
- [ ] Открыть `/office` → должен быть доступ к дашборду
- [ ] Открыть `/office/inbox` → должен быть доступ к очереди работы, может назначать обращения (`inbox-assign-me`)
- [ ] Открыть `/office/search` → должен быть доступ к поиску, может искать по участкам и обращениям
- [ ] Открыть `/office/appeals` → должен быть доступ, может управлять обращениями
- [ ] Открыть `/office/appeals/[id]` → может изменять статус (`appeal-status-select`), комментировать, назначать
- [ ] Открыть `/office/registry` → должен быть доступ (read-only)
- [ ] Открыть `/office/registry/[id]` → может просматривать карточку участка, но не может редактировать финансы
- [ ] Открыть `/office/announcements` → может создавать/редактировать объявления (`announcement-editor`)
- [ ] Открыть `/office/finance` → должен быть доступ (view-only), не может импортировать

#### Сценарий 4.3: Ограничения доступа
- [ ] Открыть `/admin` → должен быть редирект на `/forbidden`
- [ ] Открыть `/cabinet` → должен быть редирект на `/forbidden`

### 5. Бухгалтер (accountant)

#### Сценарий 5.1: Вход в офис
- [ ] Открыть `/staff/login`
- [ ] Ввести логин/пароль бухгалтера
- [ ] После входа должен быть редирект на `/office/dashboard`
- [ ] Должен быть виден `office-shell`

#### Сценарий 5.2: Доступ к финансам
- [ ] Открыть `/office` → должен быть доступ к дашборду
- [ ] Открыть `/office/inbox` → может просматривать очередь, но не может назначать (`inbox-assign-me` не видна)
- [ ] Открыть `/office/search` → может искать, видит финансы в результатах поиска
- [ ] Открыть `/office/finance` → может управлять финансами (`finance-import`, `finance-export`)
- [ ] Открыть `/office/finance/import` → может импортировать платежи, видит предпросмотр (`finance-import`)
- [ ] Открыть `/office/registry` → может просматривать реестр (read)
- [ ] Открыть `/office/registry/[id]` → может просматривать карточку участка, видит финансы/долги
- [ ] Открыть `/office/appeals` → может просматривать обращения (view-only), может комментировать, но не может изменять статус
- [ ] Открыть `/office/appeals/[id]` → может комментировать (`appeal-comment-text`), но не может изменять статус (`appeal-status-select` не виден)

#### Сценарий 5.3: Ограничения доступа
- [ ] Открыть `/admin` → должен быть редирект на `/forbidden`
- [ ] Открыть `/cabinet` → должен быть редирект на `/forbidden`

### 6. Член СНТ (resident)

#### Сценарий 6.1: Вход в кабинет
- [ ] Открыть `/login`
- [ ] Ввести код доступа
- [ ] После входа должен быть редирект на `/cabinet`
- [ ] Должен быть виден кабинет жителя

#### Сценарий 6.2: Навигация по кабинету
- [ ] Открыть `/cabinet` → должен быть виден кабинет
- [ ] Проверить доступ к разделам кабинета

#### Сценарий 6.3: Ограничения доступа
- [ ] Открыть `/admin` → должен быть редирект на `/forbidden`
- [ ] Открыть `/office` → должен быть редирект на `/forbidden`

### 7. Общие проверки

#### Сценарий 7.1: Страницы ошибок
- [ ] Открыть несуществующую страницу → должна быть 404 с CTA
- [ ] Вызвать ошибку → должна быть 500 с CTA
- [ ] Открыть `/forbidden` → должны быть CTA (Назад, В админку/В офис, На сайт, Войти/Выйти)

#### Сценарий 7.2: Навигация "Назад к списку"
- [ ] Открыть любую деталку admin (например, `/admin/registry/123`)
- [ ] Должна быть кнопка "← Назад к списку"
- [ ] Кнопка должна вести на список

#### Сценарий 7.3: Quick Actions
- [ ] На `/admin` должны быть видны quick actions (реестр, импорт, должники, обращения)
- [ ] На `/office` должны быть видны quick actions (обращения, финансы, реестр, объявления)

### 8. Office - Детальные сценарии

#### Сценарий 8.1: Dashboard (Дашборд)
- [ ] Открыть `/office` → должен быть виден `office-dashboard-page`
- [ ] Проверить метрики: новые обращения, в работе, просрочено (по роли)
- [ ] Проверить quick actions: ссылки на основные разделы
- [ ] Проверить навигацию: меню OfficeShell должно быть видно

#### Сценарий 8.2: Inbox (Очередь работы)
- [ ] Открыть `/office/inbox` → должен быть виден `office-inbox-page`
- [ ] Проверить фильтры: new, in_progress, needs_info, overdue, closed
- [ ] Проверить переключатель scope: mine/all
- [ ] Проверить поиск: поле поиска `q`
- [ ] Для chairman/secretary/admin: проверить кнопку "Назначить мне" (`inbox-assign-me`)
- [ ] Для accountant: проверить, что кнопка "Назначить мне" не видна

#### Сценарий 8.3: Search (Глобальный поиск)
- [ ] Открыть `/office/search` → должен быть виден `office-search-page`
- [ ] Проверить поисковую строку (`office-search-input`) с debounce
- [ ] Выполнить поиск по участку → должны быть результаты (`search-result-plot`)
- [ ] Выполнить поиск по обращению → должны быть результаты (`search-result-appeal`)
- [ ] Проверить пустое состояние при отсутствии результатов
- [ ] Проверить loading состояние во время поиска
- [ ] Для accountant/admin: проверить, что финансы видны в результатах поиска

#### Сценарий 8.4: Plot 360 (Карточка участка)
- [ ] Открыть `/office/registry` → должен быть виден список участков
- [ ] Кликнуть на участок → открыть `/office/registry/[id]` → должен быть виден `office-plot-page`
- [ ] Проверить секцию контактов/владельцев/заметок (read-only)
- [ ] Проверить список связанных обращений (`plot-appeals`)
- [ ] Проверить секцию документов (заглушка "скоро")
- [ ] Для accountant/admin: проверить, что финансы/долги видны
- [ ] Для chairman/secretary: проверить, что финансы не видны (или read-only)
- [ ] Проверить activity feed (`plot-activity`) с событиями по участку

#### Сценарий 8.5: Appeals (Обращения)
- [ ] Открыть `/office/appeals` → должен быть виден `office-appeals-page`
- [ ] Открыть обращение `/office/appeals/[id]` → должна быть видна карточка (`office-appeal-details`)
- [ ] Для chairman/secretary/admin: проверить возможность изменения статуса (`appeal-status-select`)
- [ ] Для accountant: проверить, что изменение статуса недоступно (read-only)
- [ ] Проверить форму комментариев (`appeal-comment-text`, `appeal-comment-submit`)
- [ ] Для secretary/admin: проверить кнопку "Вставить шаблон" (`appeal-insert-template`)
- [ ] Проверить список комментариев и ленту сообщений
